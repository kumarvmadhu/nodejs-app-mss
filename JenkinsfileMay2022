pipeline{
    agent any
    tools {nodejs "Node"}
    stages {
        stage('Clone Repository'){
            steps{
                git branch: 'main',
                    url: 'https://github.com/kumarvmadhu/nodejs-app-mss.git'
            }
        }
        //Build
        stage('Build'){
        nodejs(nodeJSInstallationName: 'nodejs18.6.0'){
          sh "npm install"
        }
      }

      //Execute SOnarQUbe Report
      stage('ExecuteSonarQubeReport'){
      nodejs(nodeJSInstallationName: 'nodejs18.6.0'){
          sh "npm run sonar"
        }
      }

      stage('UploadArtifcatsintoNexus')
        {
            sh "npm publish"
        }

      stage('RunNodeJsApp')
      {
          sh "npm run app.js &"
      }

  }
}
